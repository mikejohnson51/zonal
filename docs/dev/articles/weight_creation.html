<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weight Maps • zonal</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Weight Maps">
<meta property="og:description" content="zonal">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zonal</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_weight_creation.html">Weight Maps</a>
    </li>
    <li>
      <a href="../articles/02_intersections.html">Zonal Statistics</a>
    </li>
    <li>
      <a href="../articles/03_categorical.html">Categorical Data</a>
    </li>
    <li>
      <a href="../articles/categorical.html">Categorical Data</a>
    </li>
    <li>
      <a href="../articles/intersections.html">Zonal Statistics</a>
    </li>
    <li>
      <a href="../articles/weight_creation.html">Weight Maps</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mikejohnson51/zonal/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="weight_creation_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Weight Maps</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikejohnson51/zonal/blob/master/vignettes/weight_creation.Rmd"><code>vignettes/weight_creation.Rmd</code></a></small>
      <div class="hidden name"><code>weight_creation.Rmd</code></div>

    </div>

    
    
<div id="methods" class="section level2">
<h2 class="hasAnchor">
<a href="#methods" class="anchor"></a>Methods</h2>
<p>The first step in computing zonal statistics are the need to compute a weight map that can be used to reallocate the gridded data with respect to the percent overlapping each cell. There are two primary packages that tackle this which include <code>intersectr</code> (which uses <code>areal</code> as a back-end) and <code>zonal</code> which uses <code>exactextractr</code>.</p>
<div id="option-1-intersectr" class="section level3">
<h3 class="hasAnchor">
<a href="#option-1-intersectr" class="anchor"></a>Option 1: Intersectr:</h3>
<p>Setting up the data for a <code>intersectr</code> weights map requires (1) computing a vector representation of the grid and (2) intersecting the aggregation units with this grid to determine the percent overlap or “coverage fraction”. Below the workflow from the <code>intersectr</code> docs is wrapped in a function that requires a NetCDF file path, a <code>sf</code> geometry set, an ID variable in the geometries and the variable to extract from the grid.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USGS-R/intersectr">intersectr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/ncmeta">ncmeta</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mjwoods/RNetCDF">RNetCDF</a></span><span class="op">)</span>

<span class="va">intersectr_weights</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span>, <span class="va">geom</span>, <span class="va">ID</span>, <span class="va">var</span> <span class="op">)</span><span class="op">{</span>
  <span class="va">nc_coord_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncmeta/man/nc_coord_var.html">nc_coord_var</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">variable_name</span> <span class="op">&lt;-</span> <span class="va">var</span>
  <span class="va">nc_coord_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nc_coord_vars</span>, <span class="va">variable</span> <span class="op">==</span> <span class="va">variable_name</span><span class="op">)</span>
  
  <span class="va">nc</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/open.nc.html">open.nc</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">X_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/var.get.nc.html">var.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="va">nc_coord_vars</span><span class="op">$</span><span class="va">X</span>, unpack <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">Y_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/var.get.nc.html">var.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="va">nc_coord_vars</span><span class="op">$</span><span class="va">Y</span>, unpack <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="va">nc_prj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncmeta/man/nc_gm_to_prj.html">nc_gm_to_prj</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ncmeta/man/nc_grid_mapping_atts.html">nc_grid_mapping_atts</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span>
    
  <span class="va">cell_geometry</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/intersectr/man/create_cell_geometry.html">create_cell_geometry</a></span><span class="op">(</span>X_coords <span class="op">=</span> <span class="va">X_coords</span>,
                         Y_coords <span class="op">=</span> <span class="va">Y_coords</span>,
                         prj <span class="op">=</span> <span class="va">nc_prj</span>,
                         geom <span class="op">=</span> <span class="va">geom</span>, 
                         buffer_dist <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># Degrees</span>
                         regularize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    
  <span class="va">data_source_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cell_geometry</span>, <span class="va">grid_ids</span><span class="op">)</span><span class="op">)</span>
  <span class="va">target_polygons</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">geom</span>, <span class="op">!</span><span class="op">!</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_agr</a></span><span class="op">(</span><span class="va">data_source_cells</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"constant"</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_agr</a></span><span class="op">(</span><span class="va">target_polygons</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="st">"constant"</span>
    
  <span class="fu"><a href="https://rdrr.io/pkg/intersectr/man/calculate_area_intersection_weights.html">calculate_area_intersection_weights</a></span><span class="op">(</span>
      <span class="va">data_source_cells</span>,
      <span class="va">target_polygons</span>, allow_lonlat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="option-2-zonal" class="section level3">
<h3 class="hasAnchor">
<a href="#option-2-zonal" class="anchor"></a>Option 2: Zonal</h3>
<p>In <code>zonal</code> grid weights are calcuated using <code>exactextractr</code> as the backend. The key function needed in <code>weighting_grid</code>.</p>
</div>
</div>
<div id="use-cases" class="section level2">
<h2 class="hasAnchor">
<a href="#use-cases" class="anchor"></a>Use Cases</h2>
<p>Here two motivating use cases are shown to compare the efficiency of these two approaches. The first covers a large area but has many small aggregation units. The second also covers a large area but has a few large polygon agggreation units. Each of these poses a unique set of demands with repect to how</p>
</div>
<div id="many-small-aggregation-units" class="section level1">
<h1 class="hasAnchor">
<a href="#many-small-aggregation-units" class="anchor"></a>Many small aggregation units</h1>
<div id="watersheds-along-the-east-coast" class="section level3">
<h3 class="hasAnchor">
<a href="#watersheds-along-the-east-coast" class="anchor"></a>~20,000 watersheds along the east coast</h3>
<ul>
<li>Large Area, Lots of aggregation units</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span>  <span class="st">'/Users/mjohnson/Downloads/pet_1979.nc'</span>

<span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">'/Users/mjohnson/github/hydrofabric/workflow/nhd_workflows/cache/ngen_01a-4.gpkg'</span>, <span class="st">"catchments"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The gridded data and aggregate units we are working with can be seen below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ncmeta/man/nc_dims.html">nc_dims</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;      id name  length unlim</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt;</span>
<span class="co">#&gt; 1     0 lon     1386 FALSE</span>
<span class="co">#&gt; 2     1 lat      585 FALSE</span>
<span class="co">#&gt; 3     2 day      365 FALSE</span>
<span class="co">#&gt; 4     3 crs        1 FALSE</span></code></pre></div>
<p>The grid we are working with holds daily PET values for CONUS for the year 1979. It has:</p>
<ul>
<li>1,386 X_cells</li>
<li>585 Y_cells</li>
<li>365 time slices</li>
</ul>
<p>for a total of 295,945,650 values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span>
<span class="co">#&gt; Rows: 19,700</span>
<span class="co">#&gt; Columns: 3</span>
<span class="co">#&gt; $ comid    &lt;dbl&gt; 4289595, 4290057, 4287059, 4287061, 4292649, 4292651, 4287199, 4287195, 4…</span>
<span class="co">#&gt; $ areasqkm &lt;dbl&gt; 12.2707416, 4.0614450, 2.8056073, 6.7866652, 18.1573074, 27.8619553, 11.6…</span>
<span class="co">#&gt; $ geom     &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1976295 290..., MULTIPOLYGON (((1976415 290.…</span></code></pre></div>
<p>In total we have 19,700 aggregation units to summarize over the 365 time steps.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bnch</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bench/man/mark.html">mark</a></span><span class="op">(</span>
  iterations <span class="op">=</span> <span class="fl">1</span>, check <span class="op">=</span> <span class="cn">FALSE</span>, time_unit <span class="op">=</span> <span class="st">"s"</span>,
  intersectr <span class="op">=</span> <span class="fu">intersectr_weights</span><span class="op">(</span><span class="va">file</span>, <span class="va">geom</span>, <span class="st">"comid"</span>, <span class="st">"potential_evapotranspiration"</span><span class="op">)</span>,
  zonal      <span class="op">=</span> <span class="fu">zonal</span><span class="fu">::</span><span class="fu"><a href="../reference/weighting_grid.html">weighting_grid</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">geom</span>, <span class="st">"comid"</span><span class="op">)</span>,
<span class="op">)</span></code></pre></div>
<table class="table table table-condensed">
<thead><tr>
<th style="text-align:right;">
expression
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
mem_alloc
</th>
<th style="text-align:right;">
median_rel
</th>
<th style="text-align:right;">
mem_rel
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
intersectr
</td>
<td style="text-align:right;">
84.29004
</td>
<td style="text-align:right;">
860.8164MB
</td>
<td style="text-align:right;">
4.966625
</td>
<td style="text-align:right;">
1.327933
</td>
</tr>
<tr>
<td style="text-align:right;">
zonal
</td>
<td style="text-align:right;">
16.97129
</td>
<td style="text-align:right;">
648.2377MB
</td>
<td style="text-align:right;">
1.000000
</td>
<td style="text-align:right;">
1.000000
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="a-few-large-aggregation-units" class="section level1">
<h1 class="hasAnchor">
<a href="#a-few-large-aggregation-units" class="anchor"></a>A few large aggregation units</h1>
<div id="counties-in-colorado" class="section level3">
<h3 class="hasAnchor">
<a href="#counties-in-colorado" class="anchor"></a>~ 64 counties in Colorado</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colorado</span>  <span class="op">=</span> <span class="fu">AOI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AOI/man/aoi_get.html">aoi_get</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"CO"</span>, county <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">colorado</span><span class="op">)</span>
<span class="co">#&gt; Rows: 64</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ statefp           &lt;chr&gt; "08", "08", "08", "08", "08", "08", "08", "08", "08", "08", "08"…</span>
<span class="co">#&gt; $ countyfp          &lt;chr&gt; "035", "095", "039", "014", "037", "053", "025", "003", "065", "…</span>
<span class="co">#&gt; $ countyns          &lt;chr&gt; "00198133", "00198163", "00198136", "01945881", "00198134", "001…</span>
<span class="co">#&gt; $ affgeoid          &lt;chr&gt; "0500000US08035", "0500000US08095", "0500000US08039", "0500000US…</span>
<span class="co">#&gt; $ geoid             &lt;chr&gt; "08035", "08095", "08039", "08014", "08037", "08053", "08025", "…</span>
<span class="co">#&gt; $ name              &lt;chr&gt; "Douglas", "Phillips", "Elbert", "Broomfield", "Eagle", "Hinsdal…</span>
<span class="co">#&gt; $ lsad              &lt;chr&gt; "06", "06", "06", "06", "06", "06", "06", "06", "06", "06", "06"…</span>
<span class="co">#&gt; $ aland             &lt;dbl&gt; 2176272717, 1781724973, 4793658887, 85478497, 4362874882, 289361…</span>
<span class="co">#&gt; $ awater            &lt;dbl&gt; 6752511, 301808, 442148, 1411781, 18849997, 15324686, 33430385, …</span>
<span class="co">#&gt; $ state_name        &lt;chr&gt; "Colorado", "Colorado", "Colorado", "Colorado", "Colorado", "Col…</span>
<span class="co">#&gt; $ state_abbr        &lt;chr&gt; "CO", "CO", "CO", "CO", "CO", "CO", "CO", "CO", "CO", "CO", "CO"…</span>
<span class="co">#&gt; $ jurisdiction_type &lt;chr&gt; "state", "state", "state", "state", "state", "state", "state", "…</span>
<span class="co">#&gt; $ geometry          &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-105.2178 3..., MULTIPOLYGON (((-10…</span></code></pre></div>
<p>In total we have 64 aggregation units to summarize over the 365 time steps.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bnch2</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bench/man/mark.html">mark</a></span><span class="op">(</span>
  iterations <span class="op">=</span> <span class="fl">1</span>, check <span class="op">=</span> <span class="cn">FALSE</span>, time_unit <span class="op">=</span> <span class="st">"s"</span>,
  intersectr <span class="op">=</span> <span class="fu">intersectr_weights</span><span class="op">(</span><span class="va">file</span>, <span class="va">colorado</span>, <span class="st">"name"</span>, <span class="st">"potential_evapotranspiration"</span><span class="op">)</span>,
  zonal      <span class="op">=</span> <span class="fu">zonal</span><span class="fu">::</span><span class="fu"><a href="../reference/weighting_grid.html">weighting_grid</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">colorado</span>, <span class="st">"name"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<table class="table table table-condensed">
<thead><tr>
<th style="text-align:right;">
expression
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
mem_alloc
</th>
<th style="text-align:right;">
median_rel
</th>
<th style="text-align:right;">
mem_rel
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
intersectr
</td>
<td style="text-align:right;">
155.4526216
</td>
<td style="text-align:right;">
2.354598GB
</td>
<td style="text-align:right;">
974.7791
</td>
<td style="text-align:right;">
155.8236
</td>
</tr>
<tr>
<td style="text-align:right;">
zonal
</td>
<td style="text-align:right;">
0.1594747
</td>
<td style="text-align:right;">
15.47332MB
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
</tbody>
</table>
<p>Notably the <code>intersectr</code> approach, based on vector intersections, is unable to scale well when the aggregation units are large.</p>
</div>
<div id="what-is-a-weight-grid" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-a-weight-grid" class="anchor"></a>What is a weight grid?</h3>
<p>A weight grid is unique to the aggregate units and grid. It contains columns documenting the X and Y indexes of each grid cell along with the grid id. The XY are realtive to teh entired grid, while the grid ID is unquie to the grid subset to the bounding domain of the aggregations unit(s). Additionally the <code>w</code> stores the percent overlap between the grid cell and the aggregation unit identified by the ID column which is defined in the <code>build</code>weighting_grid` function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zonal</span>      <span class="op">=</span> <span class="fu">zonal</span><span class="fu">::</span><span class="fu"><a href="../reference/weighting_grid.html">weighting_grid</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">colorado</span>, <span class="st">"name"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">zonal</span><span class="op">)</span>
<span class="co">#&gt;      Y   X grid_id         w   name</span>
<span class="co">#&gt; 1: 203 378       1 0.2724911 Moffat</span>
<span class="co">#&gt; 2: 203 379       2 0.9152694 Moffat</span>
<span class="co">#&gt; 3: 203 380       3 0.9145876 Moffat</span>
<span class="co">#&gt; 4: 203 381       4 0.9139059 Moffat</span>
<span class="co">#&gt; 5: 203 382       5 0.9132242 Moffat</span>
<span class="co">#&gt; 6: 203 383       6 0.9125424 Moffat</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mike Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
